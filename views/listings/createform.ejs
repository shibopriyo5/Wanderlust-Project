<% layout("/layouts/boilerplate") %>

<body>

    <form action="/getlistings/create" method="POST" novalidate class="needs-validation" enctype="multipart/form-data">
        <div class="container">
            <div class="row">
                  <div class="mb-3 col-8 offset-2">
                    <label for="Input1" class="form-label">Title</label>
                    <input type="text" class="form-control" id="Input1" name="listing[title]" required>
                    <div class="invalid-feedback">This is a required field</div>
                </div>
                <div class="mb-3 col-8 offset-2">
                    <label for="Input2" class="form-label">Description</label>
                    <textarea type="text" class="form-control" id="Input2" name="listing[description]" ></textarea>
                    <div class="invalid-feedback">This is a required field</div>
                </div>
                <div class="mb-3 col-8 offset-2">
               
                    <label for="image">Image</label>
                    <input type="file" name="image" id="image" accept="image/*" />
                    <div class="invalid-feedback">This is a required field</div>
                </div>
                <div class="mb-3 col-8 offset-2">
                    <label for="Input4" class="form-label">Price</label>
                    <input type="number" class="form-control" id="Input4" name="listing[Price]" required>
                    <div class="invalid-feedback">This is a required field</div>
                </div>
                <div class="mb-3 col-8 offset-2">
                    <label for="Input5" class="form-label">Location</label>
                    <input type="text" class="form-control" id="Input5" name="listing[location]" required>
                    <div class="invalid-feedback">This is a required field</div>
                </div>

                

                <div class="mb-3 col-8 offset-2">
                    <label for="Input6" class="form-label">Country</label>
                    <input type="text" class="form-control" id="Input6" name="listing[country]" required>
                    <div class="invalid-feedback">This is a required field</div>
                </div>
                <label>Enter Location (City / Area / Country)</label>
                <input type="text" id="locationInput" placeholder="e.g. Manuel Antonio, Costa Rica">

                <button type="button" id="findLocation">
                    Find on Map

                </button>


                <div id="map" style="height: 400px; margin-top: 10px;"></div>

                <p>
                    <strong>Selected Coordinates:</strong>
                    <span id="locationText">Not selected</span>
                </p>

              
                <input type="hidden" name="listing[latitude]" id="lat">
                <input type="hidden" name="listing[longitude]" id="lng">


                <div class="mb-3 col-8 offset-2">
                    <label for="category" class="form-label">Category</label>
                    <select class="form-select" id="category" name="listing[category]" required>
                        <option value="">Choose...</option>
                        <option value="Sea-Side">Seaside</option>
                        <option value="Farms">Farms</option>
                        <option value="Forests">Forests</option>
                        <option value="Swimming-Pools">Swimming Pools</option>
                        <option value="Mountains">Mountains</option>
                        <option value="iconic-Cities">Iconic Cities</option>
                        <option value="castles">castles</option>
                    </select>
                    <div class="invalid-feedback">This is a required field</div>
                </div>
            </div>
          <button type="submit" class="btn btn-primary  button ">Submit</button>
        </div>
  
</form>
</body>

<script>
    
    const map = L.map("map").setView([20, 0], 2);

L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
    attribution:
        'Map data Â© <a href="https://www.openstreetmap.org/copyright" target="_blank">OpenStreetMap contributors</a>'
}).addTo(map);

    
    let marker;

   
    document.getElementById("findLocation").addEventListener("click", async () => {
        const place = document.getElementById("locationInput").value;

        if (!place) {
            alert("Please enter a location");
            return;
        }

        const response = await fetch(
            `https://nominatim.openstreetmap.org/search?format=json&q=${place}`
        );

        const data = await response.json();

        if (data.length === 0) {
            alert("Location not found");
            return;
        }

        const lat = data[0].lat;
        const lng = data[0].lon;

        map.setView([lat, lng], 13);

        if (marker) map.removeLayer(marker);

        marker = L.marker([lat, lng], { draggable: true }).addTo(map);

        updateLocation(lat, lng);
    });

  
    function updateLocation(lat, lng) {
        document.getElementById("lat").value = lat;
        document.getElementById("lng").value = lng;
        document.getElementById("locationText").innerText =
            `Latitude: ${lat}, Longitude: ${lng}`;
    }


    map.on("click", function (e) {
        if (marker) {
            marker.setLatLng(e.latlng);
        } else {
            marker = L.marker(e.latlng, { draggable: true }).addTo(map);
        }
        updateLocation(e.latlng.lat, e.latlng.lng);
    });

    map.on("mousemove", function () {
        if (marker) {
            marker.on("dragend", function (e) {
                updateLocation(
                    e.target.getLatLng().lat,
                    e.target.getLatLng().lng
                );
            });
        }
    });
</script>

