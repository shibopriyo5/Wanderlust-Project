<% layout("/layouts/boilerplate") %>
<body>

<div class="flash-container">
    <% if(suc && suc.length){ %>
        <div class="flash flash-success"><%= suc %></div>
    <% } %>
    <% if(err && err.length){ %>
        <div class="flash flash-error"><%= err %></div>
    <% } %>
</div>

<main class="listing-wrap">

 
    <section class="listing-hero">
        <div class="hero-image">
            <img src="<%= doc1.image.url %>" alt="<%= doc1.title %>">
        </div>

        <div class="hero-details">
            <h1 class="title">Owned by <%= doc1.owner.username %></h1>
            <h1 class="title"><%= doc1.title %></h1>

            <p class="meta">
                <%= doc1.location %> ‚Ä¢ <%= doc1.country %> ‚Ä¢ <%= doc1.category %>
            </p>

            <p class="description"><%= doc1.description %></p>
            <div class="price">‚Çπ <%= doc1.Price.toLocaleString("en-IN") %></div>

            <div class="actions">
                <a href="/getlistings/edit/<%= doc1._id %>" class="btn btn-primary">Edit</a>
                <form class="inline-delete" action="/getlistings/<%= doc1._id %>?_method=delete" method="POST">
                    <button class="btn btn-secondary">Delete</button>
                </form>
            </div>
        </div>
    </section>


 
<section class="location-section">

    <h2 class="location-title">Location</h2>

  
    <p class="location-text">
        üìç <%= doc1.location %>, <%= doc1.country %>
    </p>

 
    <div id="map"></div>

</section>








    <section class="reviews-section">

        <div class="reviews-column">
            <div class="reviews-card">
                <h3>
                    Customer reviews
                    <small>(<%= doc1.reviews.length %>)</small>
                </h3>

                <div class="reviews-list">
                    <% if(doc1.reviews.length){ %>
                        <% doc1.reviews.forEach(r => { %>
                            <div class="review-item">
                                <div class="review-header">
                                    <span class="review-rating">‚òÖ <%= r.Rating %></span>
                                    <form action="/getlistings/<%= doc1._id %>/reviews/<%= r._id %>?_method=delete" method="POST">
                                        <button class="review-delete">Delete</button>
                                    </form>
                                </div>

                                <p class="review-body"><%= r.comment %></p>
                                <small class="review-user">Reviewed by <%= r.revowner.username %></small>
                            </div>
                        <% }) %>
                    <% } else { %>
                        <div class="empty">No reviews yet.</div>
                    <% } %>
                </div>
            </div>
        </div>

        <!-- Review form -->
        <div class="form-column">
            <div class="review-form-card">
                <h3>Leave a review</h3>
                <p class="review-sub">Share your experience ‚Äî your feedback helps others.</p>

                <form class="review-form" action="/getlistings/<%= doc1._id %>/reviews" method="POST">

                    <label class="label">Rating</label>


                                            <div class="star-rating">

                            <input type="hidden" name="review[Rating]" id="rating" value="1">

                            <span class="star" data-value="1">‚òÖ</span>
                            <span class="star" data-value="2">‚òÖ</span>
                            <span class="star" data-value="3">‚òÖ</span>
                            <span class="star" data-value="4">‚òÖ</span>
                            <span class="star" data-value="5">‚òÖ</span>
                        </div>



                    <label class="label">Comment</label>
                    <textarea id="comment" name="review[comment]" rows="5"
                        placeholder="Write your thoughts here..."></textarea>

                    <div class="form-actions">
                        <button class="btn btn-primary">Post review</button>
                        <small class="form-note">Be respectful ‚Äî reviews help the community.</small>
                    </div>
                </form>
            </div>
        </div>

    </section>
</main>


<style>


:root{
    --primary:#2563eb;
    --secondary:#6b7280;
    --bg:#f8fafc;
    --card:#ffffff;
    --radius:16px;
    --shadow:0 10px 30px rgba(0,0,0,.08);
}


*{box-sizing:border-box}
body{
    margin:0;
    background:var(--bg);
    font-family:system-ui,-apple-system,BlinkMacSystemFont;
    color:#111827;
}

.listing-wrap{
    max-width:1200px;
    margin:40px auto;
    padding:0 16px;
}


.listing-hero{
    display:grid;
    grid-template-columns:480px 1fr;
    gap:32px;
    align-items:stretch;
}

.hero-image img{
    width:100%;
    height:100%;
    max-height:420px;
    object-fit:cover;
    border-radius:var(--radius);
    box-shadow:var(--shadow);
}

.hero-details{
    background:var(--card);
    padding:28px;
    border-radius:var(--radius);
    box-shadow:var(--shadow);
    display:flex;
    flex-direction:column;
    gap:14px;
}

.title{
    margin:0;
    font-size:28px;
    font-weight:700;
}

.meta{
    color:#6b7280;
    font-size:14px;
}

.description{
    font-size:15px;
    line-height:1.6;
}

.price{
    font-size:26px;
    font-weight:800;
    color:var(--primary);
}


.actions{
    display:flex;
    gap:12px;
    margin-top:auto;
}

.btn{
    border:none;
    border-radius:10px;
    padding:10px 18px;
    font-size:14px;
    cursor:pointer;
    text-decoration:none;
    display:inline-flex;
    align-items:center;
    justify-content:center;
}

.btn-primary{
    background:linear-gradient(135deg,#2563eb,#3b82f6);
    color:#fff;
}

.btn-secondary{
    background:#e5e7eb;
    color:#111827;
}


.reviews-section{
    margin-top:40px;
    display:grid;
    grid-template-columns:1fr 420px;
    gap:28px;
}


.reviews-card,
.review-form-card{
    background:var(--card);
    padding:24px;
    border-radius:var(--radius);
    box-shadow:var(--shadow);
}


.review-item{
    border:1px solid #e5e7eb;
    border-radius:12px;
    padding:14px;
    margin-top:12px;
}

.review-header{
    display:flex;
    justify-content:space-between;
    align-items:center;
}

.review-rating{
    font-weight:700;
}

.review-body{
    margin:10px 0;
    font-size:14px;
}

.review-user{
    color:#6b7280;
    font-size:12px;
}

.review-delete{
    background:#fee2e2;
    border:1px solid #fecaca;
    padding:4px 10px;
    border-radius:8px;
    cursor:pointer;
}


.review-form{
    display:flex;
    flex-direction:column;
    gap:14px;
}

.label{
    font-weight:600;
    font-size:14px;
}

textarea{
    width:100%;
    padding:12px;
    border-radius:12px;
    border:1px solid #e5e7eb;
    resize:vertical;
}

.form-actions{
    display:flex;
    gap:12px;
    align-items:center;
}

.form-note{
    font-size:12px;
    color:#6b7280;
}


.star-rating{
    display:flex;
    gap:8px;
    font-size:32px;
    cursor:pointer;
}

.star{
    color:#d1d5db;
    transition:.15s;
}

.star.active{
    color:#facc15;
}

.star:hover{
    transform:scale(1.15);
}




.flash-container{
    max-width:1200px;
    margin:20px auto;
    padding:0 16px;
}

.flash{
    padding:12px 16px;
    border-radius:10px;
    font-weight:600;
    margin-bottom:10px;
}

.flash-success{
    background:#dcfce7;
    color:#065f46;
}

.flash-error{
    background:#fee2e2;
    color:#7f1d1d;
}



@media (max-width:900px){
    .listing-hero{
        grid-template-columns:1fr;
    }

    .hero-image img{
        max-height:260px;
    }

    .reviews-section{
        grid-template-columns:1fr;
    }

    .actions{
        flex-direction:column;
    }

    .btn{
        width:100%;
    }
}

@media (max-width:480px){
    .title{
        font-size:22px;
    }

    .price{
        font-size:22px;
    }

    .star-rating{
        font-size:26px;
    }
}


.location-section{
    margin-top:40px;
    background:var(--card);
    padding:24px;
    border-radius:var(--radius);
    box-shadow:var(--shadow);
}

.location-title{
    font-size:20px;
    font-weight:700;
    margin-bottom:6px;
}

.location-text{
    font-size:15px;
    color:#374151;
    margin-bottom:16px;
    display:flex;
    align-items:center;
    gap:6px;
}


#map{
    width:100%;
    height:360px;
    border-radius:14px;
}

</style>









<script>

const coordinates = [
        <%= doc1.geometry.coordinates[1] %> , // latitude
        <%= doc1.geometry.coordinates[0] %>  // longitude
    ];



    const map = L.map("map").setView(coordinates, 6);


    L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
    attribution:
        'Map data ¬© <a href="https://www.openstreetmap.org/copyright" target="_blank">OpenStreetMap contributors</a>'
}).addTo(map);



    L.marker(coordinates)
        .addTo(map)
        .bindPopup("<%= doc1.title %>");



    const stars = document.querySelectorAll(".star");
    const ratingInput = document.getElementById("rating");

    function updateStars(value){
        stars.forEach(star=>{
            star.classList.toggle(
                "active",
                star.dataset.value <= value
            );
        });
    }

    updateStars(ratingInput.value);

    stars.forEach(star=>{
        star.addEventListener("click",()=>{
            const value = star.dataset.value;
            ratingInput.value = value;
            updateStars(value);
        });
    });
</script>

